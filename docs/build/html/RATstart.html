

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>1. RATstart &mdash; librat  documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="librat  documentation" href="index.html"/>
        <link rel="next" title="2. RATstart options" href="RATstartOptions.html"/>
        <link rel="prev" title="Welcome to librat" href="index.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> librat
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">1. <code class="docutils literal notranslate"><span class="pre">RATstart</span></code></a><ul>
<li class="toctree-l2"><a class="reference internal" href="#RATstart-(formerly-start)">1.1. <code class="docutils literal notranslate"><span class="pre">RATstart</span></code> (formerly <code class="docutils literal notranslate"><span class="pre">start</span></code>)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Getting-started">1.1.1. Getting started</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Initialisation-shells">1.1.2. Initialisation shells</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Environment-variables">1.2. Environment variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Making-some-basic-files">1.3. Making some basic files</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#bash-constructs">1.3.1. <code class="docutils literal notranslate"><span class="pre">bash</span></code> constructs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#first.obj-and-associated-files">1.3.2. <code class="docutils literal notranslate"><span class="pre">first.obj</span></code> and associated files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#height-map-visualisation">1.3.3. height map visualisation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Ray-tracing">1.3.4. Ray tracing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Summary">1.3.5. Summary</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="RATstartOptions.html">2. <code class="docutils literal notranslate"><span class="pre">RATstart</span></code> options</a></li>
<li class="toctree-l1"><a class="reference internal" href="Chapter1.html">3. librat</a></li>
<li class="toctree-l1"><a class="reference internal" href="Chapter2.html">4. Basic librat / RATstart operation</a></li>
<li class="toctree-l1"><a class="reference internal" href="Appendix1.html">5. Appendix 1: <code class="docutils literal notranslate"><span class="pre">bash</span></code> help</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">librat</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li><span class="section-number">1. </span><code class="docutils literal notranslate"><span class="pre">RATstart</span></code></li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/RATstart.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    min-width: 7ex;
    padding-top: 0.3rem;
    padding-right: 0.3rem;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 0.3rem;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="RATstart">
<h1><span class="section-number">1. </span><code class="docutils literal notranslate"><span class="pre">RATstart</span></code><a class="headerlink" href="#RATstart" title="Permalink to this headline">¶</a></h1>
<p>This section deals with using the direct interface to the <code class="docutils literal notranslate"><span class="pre">librat</span></code> code at a high level, through the <code class="docutils literal notranslate"><span class="pre">RATstart</span></code> software. This is a short piece of <code class="docutils literal notranslate"><span class="pre">C</span></code> code, the main role of with is to present a set of simple functions controlled by text input on the command line. One of these ‘options’ (option 14) gives an extremely fexible interface for defining viewing and illumination conditions for radiative transfer simulations, and it is this part of the interface that is most widely used.</p>
<p>In this section, we introduce some of the functionality of <code class="docutils literal notranslate"><span class="pre">RATstart</span></code>. We use a <code class="docutils literal notranslate"><span class="pre">bash</span></code> environment here around <code class="docutils literal notranslate"><span class="pre">RATstart</span></code> to emphasise skills and code in running this from a standard <code class="docutils literal notranslate"><span class="pre">*nix</span></code> command lines. We use a python3 environment for plotting and related codes.</p>
<p>We first set some local variables.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">prelim</span> <span class="kn">import</span> <span class="o">*</span>
<span class="o">%</span><span class="k">set_env</span> BPMS=$BPMS
<span class="o">%</span><span class="k">set_env</span> PATH=$BPMS/bin:$BPMS/src:$BPMS/bin/csh:$PATH_
<span class="o">%</span><span class="k">set_env</span> MATLIB=$BPMS/obj
<span class="o">%</span><span class="k">set_env</span> BPMSROOT=$BPMS/obj
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
env: BPMS=/Users/plewis/librat
env: PATH=/Users/plewis/librat/bin:/Users/plewis/librat/src:/Users/plewis/librat/bin/csh:/Users/plewis/opt/anaconda3/bin:/Users/plewis/opt/anaconda3/condabin:/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin:/Applications/VMware Fusion.app/Contents/Public:/Library/TeX/texbin:/opt/X11/bin:/Library/Apple/usr/bin
env: MATLIB=/Users/plewis/librat/obj
env: BPMSROOT=/Users/plewis/librat/obj
</pre></div></div>
</div>
<div class="section" id="RATstart-(formerly-start)">
<h2><span class="section-number">1.1. </span><code class="docutils literal notranslate"><span class="pre">RATstart</span></code> (formerly <code class="docutils literal notranslate"><span class="pre">start</span></code>)<a class="headerlink" href="#RATstart-(formerly-start)" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">RATstart</span></code> used to be called <code class="docutils literal notranslate"><span class="pre">start</span></code>, but that causes conflicts sometimes, so its now changed to <code class="docutils literal notranslate"><span class="pre">RATstart</span></code>.</p>
<div class="section" id="Getting-started">
<h3><span class="section-number">1.1.1. </span>Getting started<a class="headerlink" href="#Getting-started" title="Permalink to this headline">¶</a></h3>
<p>The minimum requirement for the <code class="docutils literal notranslate"><span class="pre">RATstart</span></code> command line is the declaration of some object file to use in the simulation. An object file describes the real world geometry and scattering properties of the objects we are using in the simulation, such as some representation of a vegetation canopy. We generate a very simple object file for demonstrating <code class="docutils literal notranslate"><span class="pre">RATstart</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!{
usemtl WHITE
v 0 0 0
sph -1 100
!}
</pre></div>
</div>
<p>Other than that, its functionality is mainly controlled though a series of option codes read on the input.</p>
<p>Valid options are (currently) between 0 and 16, inclusive, with some missing. You shouldn’t use the ones not listed as they tend to be experimental and may not work as expected.</p>
<p>If we give a non-valid option code, we get the help message:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre>
<span></span>%%bash

<span class="c1"># a simple object file</span>
<span class="c1"># and invalid code: 1000</span>
<span class="c1"># to see the options</span>
<span class="c1"># a very simple object file</span>
cat <span class="s">&lt;&lt;EOF &gt; $BPMSROOT/tmp.$$.obj</span>
<span class="s">!{</span>
<span class="s">usemtl WHITE</span>
<span class="s">v 0 0 0</span>
<span class="s">sph -1 100</span>
<span class="s">!}</span>
<span class="s">EOF</span>

<span class="nb">export</span> <span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">BPMS</span><span class="si">}</span><span class="s2">/src:</span><span class="si">${</span><span class="nv">LD_LIBRARY_PATH</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="nb">export</span> <span class="nv">DYLD_LIBRARY_PATH</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">BPMS</span><span class="si">}</span><span class="s2">/src:</span><span class="si">${</span><span class="nv">DYLD_LIBRARY_PATH</span><span class="si">}</span><span class="s2">&quot;</span>
RATstart tmp.<span class="nv">$$</span>.obj <span class="o">&lt;&lt;&lt;</span> <span class="m">1000</span><span class="p">;</span>

<span class="c1"># tidy up, removing file</span>
rm -f <span class="nv">$BPMSROOT</span>/tmp.<span class="nv">$$</span>.obj
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
options:
         0                   : quit
         1 n s1x s1y s1z ... : set sun vectors
         2                   : print sun vectors
         6 fx fy fz dx dy dz : trace ray from f in direction d
         7                   : get and print materials
         9                   : print info on materials used
         10                  : get and set verbosity level (0-1)
         11                  : get and print object bbox information
         13                  : same as 14 assuming filenames camera.dat light.dat
         14 camera.dat light.dat
                             : ray tracing using defined camera &amp; illumination
         16 cx cy cz sx sy nrows ncols rpp name
                             : produce a height map in name
</pre></div></div>
</div>
<p>As noted above, we most commonly use option <code class="docutils literal notranslate"><span class="pre">14</span></code>. This allows the definition of a ‘camera’ and ‘light source’ defined in the files <code class="docutils literal notranslate"><span class="pre">camera.dat</span></code> and <code class="docutils literal notranslate"><span class="pre">light.dat</span></code> here, respectively and gives a very general interface for radiative transfer simulations. Using the code then amounts to setting up camera and illumination files for the scenarious you are interested in, which greatly simplifies the interface.</p>
<p>The command line option <code class="docutils literal notranslate"><span class="pre">-RAThelp</span></code> will provide the list of command line options:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre>
<span></span>%%bash
<span class="c1"># a simple object file</span>
<span class="c1"># --help to see command line options</span>
<span class="c1"># a very simple object file</span>
cat <span class="s">&lt;&lt;EOF &gt; $BPMSROOT/tmp.$$.obj</span>
<span class="s">!{</span>
<span class="s">usemtl WHITE</span>
<span class="s">v 0 0 0</span>
<span class="s">sph -1 100</span>
<span class="s">!}</span>
<span class="s">EOF</span>

<span class="nb">export</span> <span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$BPMS</span><span class="s2">/src:</span><span class="si">${</span><span class="nv">LD_LIBRARY_PATH</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="nb">export</span> <span class="nv">DYLD_LIBRARY_PATH</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$BPMS</span><span class="s2">/src:</span><span class="si">${</span><span class="nv">DYLD_LIBRARY_PATH</span><span class="si">}</span><span class="s2">&quot;</span>
RATstart -RAThelp tmp.<span class="nv">$$</span>.obj <span class="o">&lt;&lt;&lt;</span> <span class="m">1000</span><span class="p">;</span>

<span class="c1"># tidy up, removing file</span>
rm -f <span class="nv">$BPMSROOT</span>/tmp.<span class="nv">$$</span>.obj
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
RATstart: [-RATm 1] [-RATl] [-RATsun_position x y z] [-RATr randomSeed] [-RATblack] [-RATblockSize blocksize] [-RATstoreVertex N] [-RATsensor_wavebands wavebands.dat] [-RATsun_fov 0 (degrees)] [-RATskymap skymap.hips] [-RATtolerance 0.00001] [-RATdirect directIllumination.dat] [-help | -RAThelp] [-RATv 0|1] [-RATn] [-Useless] [-UsetSun x y z] data_filename.obj
</pre></div></div>
</div>
<p>In the rest of this section, we will learn how to make a call to <code class="docutils literal notranslate"><span class="pre">RATstart</span></code> and how to use the various command line options and input options.</p>
</div>
<div class="section" id="Initialisation-shells">
<h3><span class="section-number">1.1.2. </span>Initialisation shells<a class="headerlink" href="#Initialisation-shells" title="Permalink to this headline">¶</a></h3>
<p>Before proceeding, we make sure we set appropriate environment variables to run a set of examples with RATstart. We also want to test that the software runs ok. We generate a <code class="docutils literal notranslate"><span class="pre">bash</span></code> shell to achieve this here, and use this in subsequent notes.</p>
<p>You can modify any of this as a user, but be careful not to break it! 🙄. In an emergency, you can always just re-download this set of notes and software from <a class="reference external" href="https://github.com/profLewis/librat">github</a> and start again.</p>
<p>If you want to know more about setting up this sort of file, and what it all means, see <a class="reference external" href="Appendix1">Appendix 1</a>. At the moment, you just need to be aware of the need to set environment variables, but not to understand all of the intricacies.</p>
<p>We simplify the interface for the environment variables by setting up the configuration file <code class="docutils literal notranslate"><span class="pre">examples_init.sh</span></code>. We then run it, to test the code.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre>
<span></span>%%bash
<span class="c1">#</span>
<span class="c1"># create examples_init.sh</span>
<span class="c1"># for examples initialisation</span>
<span class="c1">#</span>
<span class="c1"># create the init shell</span>
cat <span class="s">&lt;&lt;EOF &gt; $BPMS/bin/examples_init.sh</span>
<span class="s">#!/bin/bash</span>
<span class="s">#</span>
<span class="s"># defaults</span>
<span class="s">#</span>
<span class="s">export BPMS=\${BPMS-$BPMS}</span>
<span class="s">export BPMSROOT=\${BPMSROOT-\$BPMSROOT}</span>
<span class="s">lib=\${lib-\$BPMS/src}</span>
<span class="s">bin=\${bin-\$BPMS/src}</span>
<span class="s">VERBOSE=\${VERBOSE-0}</span>
<span class="s">export TEMP=\${TEMP-/tmp}</span>

<span class="s"># set up required environment variables for bash</span>
<span class="s">export LD_LIBRARY_PATH=&quot;\${lib}:\${LD_LIBRARY_PATH}&quot;</span>
<span class="s">export DYLD_LIBRARY_PATH=&quot;\${lib}:\${DYLD_LIBRARY_PATH}&quot;</span>
<span class="s">export PATH=&quot;\${bin}:\${PATH}&quot;</span>

<span class="s">export MATLIB=\$BPMSROOT</span>
<span class="s">export RSRLIB=\$BPMSROOT</span>
<span class="s">export ARARAT_OBJECT=\$BPMSROOT</span>
<span class="s">export DIRECT_ILLUMINATION=\$BPMSROOT</span>
<span class="s">export BPMS_FILES=\$BPMSROOT</span>
<span class="s">export SKY_ILLUMINATION==\$BPMSROOT</span>

<span class="s">if [ &quot;\$(which RATstart)&quot; == &quot;\${bin}/RATstart&quot; ]</span>
<span class="s">then</span>
<span class="s">  if [ &quot;\$VERBOSE&quot; == 1 ]; then</span>
<span class="s">      echo &quot;RATstart found ok&quot;</span>
<span class="s">  fi</span>
<span class="s">else</span>
<span class="s">  # we should create them</span>
<span class="s">  make clean all</span>
<span class="s">fi</span>
<span class="s">EOF</span>
chmod +x <span class="nv">$BPMS</span>/bin/examples_init.sh
</pre></div>
</div>
</div>
<p>Let us set the <code class="docutils literal notranslate"><span class="pre">VERBOSE</span></code> flag on, by setting:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">VERBOSE</span><span class="o">=</span><span class="mi">1</span>
</pre></div>
</div>
<p>before running <code class="docutils literal notranslate"><span class="pre">$INIT</span></code>. This will cause the shell to print <code class="docutils literal notranslate"><span class="pre">RATstart</span> <span class="pre">found</span> <span class="pre">ok</span></code> is the executable <code class="docutils literal notranslate"><span class="pre">RATstart</span></code> is where it is expected.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre>
<span></span>%%bash
<span class="c1"># run test</span>
<span class="nb">export</span> <span class="nv">VERBOSE</span><span class="o">=</span><span class="m">1</span>
<span class="nb">source</span> examples_init.sh
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RATstart found ok
</pre></div></div>
</div>
<p>The shell sets <code class="docutils literal notranslate"><span class="pre">BPMSROOT</span></code> to be <code class="docutils literal notranslate"><span class="pre">$BPMS/obj</span></code> by default. This causes other variables such as <code class="docutils literal notranslate"><span class="pre">MATLIB</span></code> to be set to the same value, so <code class="docutils literal notranslate"><span class="pre">RATstart</span></code> will look for materials in <code class="docutils literal notranslate"><span class="pre">$BPMS/obj</span></code> (see below):</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre>
<span></span>%%bash

<span class="c1"># run test</span>
<span class="nb">source</span> examples_init.sh
<span class="nb">echo</span> <span class="s2">&quot;MATLIB is </span><span class="nv">$MATLIB</span><span class="s2">&quot;</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MATLIB is /Users/plewis/librat/obj
</pre></div></div>
</div>
<p>If we want to use this shell for <code class="docutils literal notranslate"><span class="pre">BPMSROOT</span></code> elsewhere, such as <code class="docutils literal notranslate"><span class="pre">/home/me/mydata/somewhere</span></code>, we just need to make sure <code class="docutils literal notranslate"><span class="pre">BPMSROOT</span></code> is set to this before running <code class="docutils literal notranslate"><span class="pre">$INIT</span></code>:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre>
<span></span>%%bash

<span class="c1"># run test</span>
<span class="nb">export</span> <span class="nv">BPMSROOT</span><span class="o">=</span>/home/me/mydata/somewhere
<span class="nb">source</span> examples_init.sh
<span class="nb">echo</span> <span class="s2">&quot;MATLIB is </span><span class="nv">$MATLIB</span><span class="s2">&quot;</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MATLIB is /home/me/mydata/somewhere
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="Environment-variables">
<h2><span class="section-number">1.2. </span>Environment variables<a class="headerlink" href="#Environment-variables" title="Permalink to this headline">¶</a></h2>
<p>If we take a quick look at the <code class="docutils literal notranslate"><span class="pre">examples_init.sh</span></code> file we generated, we see:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>cat $BPMS/bin/examples_init.sh
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
#!/bin/bash
#
# defaults
#
export BPMS=${BPMS-/Users/plewis/librat}
export BPMSROOT=${BPMSROOT-$BPMSROOT}
lib=${lib-$BPMS/src}
bin=${bin-$BPMS/src}
VERBOSE=${VERBOSE-0}
export TEMP=${TEMP-/tmp}

# set up required environment variables for bash
export LD_LIBRARY_PATH=&#34;${lib}:${LD_LIBRARY_PATH}&#34;
export DYLD_LIBRARY_PATH=&#34;${lib}:${DYLD_LIBRARY_PATH}&#34;
export PATH=&#34;${bin}:${PATH}&#34;

export MATLIB=$BPMSROOT
export RSRLIB=$BPMSROOT
export ARARAT_OBJECT=$BPMSROOT
export DIRECT_ILLUMINATION=$BPMSROOT
export BPMS_FILES=$BPMSROOT
export SKY_ILLUMINATION==$BPMSROOT

if [ &#34;$(which RATstart)&#34; == &#34;${bin}/RATstart&#34; ]
then
  if [ &#34;$VERBOSE&#34; == 1 ]; then
      echo &#34;RATstart found ok&#34;
  fi
else
  # we should create them
  make clean all
fi
</pre></div></div>
</div>
<p>We might notice that <code class="docutils literal notranslate"><span class="pre">examples_init.sh</span></code> sets a number of environment variables, namely <code class="docutils literal notranslate"><span class="pre">MATLIB</span></code>, <code class="docutils literal notranslate"><span class="pre">RSRLIB</span></code> etc.</p>
<p>If you are interested in the details, the meaning of these is given in the table below.</p>
<p>Alternatively, just notice that in the init shell, all of these variables are set to <code class="docutils literal notranslate"><span class="pre">BPMSROOT</span></code>, so if we want to point to the location of an object and material database for librat, we need only set the environment variable <code class="docutils literal notranslate"><span class="pre">BPMSROOT</span></code> appropriately. In this case it defaults to <code class="docutils literal notranslate"><span class="pre">$BPMS/obj</span></code>.</p>
<p><strong>Table explaining librat object environment variables:</strong></p>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>File types</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">MATLIB</span></code></p></td>
<td><p>material library e.g. <code class="docutils literal notranslate"><span class="pre">plants.matlib</span></code>, all materials defined in a material library e.g. <code class="docutils literal notranslate"><span class="pre">white.dat</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">ARARAT_OBJECT</span></code></p></td>
<td><p>(extended) wavefront object files e.g. <code class="docutils literal notranslate"><span class="pre">first.obj</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DIRECT_ILLUMINATION</span></code></p></td>
<td><p>spectral files for direct illumination: those defined in <code class="docutils literal notranslate"><span class="pre">-RATdirect</span></code> command line option</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">RSRLIB</span></code></p></td>
<td><p>sensor waveband files: those defined in <code class="docutils literal notranslate"><span class="pre">-RATsensor_wavebands</span></code> command line option</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">BPMS_FILES</span></code></p></td>
<td><p>Not used</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">SKY_ILLUMINATION</span></code></p></td>
<td><p>location of sky map image files: defined in <code class="docutils literal notranslate"><span class="pre">-RATskymap</span></code> command line option</p></td>
</tr>
</tbody>
</table>
<p>You can set all of these to the same value as above (<code class="docutils literal notranslate"><span class="pre">$BPMSROOT</span></code>), in which case the database of files is all defined relative to that location in the file system. This is the most typical use of <code class="docutils literal notranslate"><span class="pre">librat</span></code>. We illustrate this setup below for the <code class="docutils literal notranslate"><span class="pre">librat</span></code> distribution, where a set of examples use files from the directory <code class="docutils literal notranslate"><span class="pre">test/test_example</span></code>.</p>
<p>Additionally in <code class="docutils literal notranslate"><span class="pre">librat</span></code>, the following environment variables can be set to extend the size of some aspects of the model. You would only need to use these in some extreme case.</p>
<p><strong>Table explaining additional librat environment variables:</strong></p>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Purpose</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">MAX_GROUPS</span></code></p></td>
<td><p>Maximum number of groups allowed (100000)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">PRAT_MAX_MATERIALS</span></code></p></td>
<td><p>Maximum number of materials allowed (DEFAULT_PRAT_MAX_MATERIALS=1024 in <code class="docutils literal notranslate"><span class="pre">mtllib.h</span></code>)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">MAX_SUNS</span></code></p></td>
<td><p>Maximum number of suns (180 in <code class="docutils literal notranslate"><span class="pre">rat.h</span></code>)</p></td>
</tr>
</tbody>
</table>
<p>If you want to run a shell that uses the setup, you will need to use the command <code class="docutils literal notranslate"><span class="pre">source</span></code> to export the variables to your shell.</p>
<p>You can test the init file by running the cell (shell) below.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre>
<span></span>%%bash

<span class="c1"># source if we want the info in this shell</span>
<span class="nb">source</span> examples_init.sh

<span class="nb">echo</span> <span class="s2">&quot;MATLIB is set to </span><span class="nv">$MATLIB</span><span class="s2">&quot;</span>
<span class="nb">echo</span> <span class="s2">&quot;RSRLIB is set to </span><span class="nv">$RSRLIB</span><span class="s2">&quot;</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MATLIB is set to /Users/plewis/librat/obj
RSRLIB is set to /Users/plewis/librat/obj
</pre></div></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">EXERCISE</span> <span class="mi">1</span>

    <span class="mf">1.</span> <span class="n">Try</span> <span class="n">changing</span> <span class="n">the</span> <span class="n">environment</span> <span class="n">variable</span> <span class="n">VERBOSE</span> <span class="n">to</span> <span class="mi">1</span> <span class="p">(</span><span class="kc">True</span><span class="p">)</span> <span class="ow">or</span> <span class="mi">0</span> <span class="p">(</span><span class="kc">False</span><span class="p">)</span> <span class="n">to</span> <span class="n">see</span> <span class="n">the</span> <span class="n">effect</span><span class="o">.</span>

    <span class="mf">2.</span> <span class="n">You</span> <span class="n">can</span> <span class="n">change</span> <span class="n">the</span> <span class="n">name</span> <span class="n">of</span> <span class="n">the</span> <span class="n">directory</span> <span class="n">where</span> <span class="n">the</span> <span class="nb">object</span> <span class="ow">and</span> <span class="n">material</span> <span class="n">files</span> <span class="n">are</span> <span class="n">through</span> <span class="n">the</span> <span class="n">environment</span> <span class="n">variable</span> <span class="n">BPMSROOT</span><span class="o">.</span> <span class="n">See</span> <span class="k">if</span> <span class="n">you</span> <span class="n">can</span> <span class="n">find</span> <span class="n">what</span> <span class="n">BPMSROOT</span> <span class="ow">is</span> <span class="nb">set</span> <span class="n">to</span><span class="p">,</span> <span class="ow">and</span> <span class="n">also</span> <span class="n">see</span> <span class="k">if</span> <span class="n">yoiu</span> <span class="n">can</span> <span class="n">modify</span> <span class="n">it</span><span class="o">.</span>
</pre></div>
</div>
<p><strong>Answers below:</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre>
<span></span>%%bash
<span class="c1"># Answers to Exercise 1</span>

<span class="c1">#----------------------</span>
<span class="c1"># this part same as above</span>
<span class="c1"># test the init file</span>
<span class="c1"># set INIT script</span>
<span class="nb">source</span> <span class="nv">$BPMS</span>/bin/local_init.sh
<span class="nb">source</span> <span class="nv">$INIT</span>
<span class="c1">#----------------------</span>

<span class="c1"># 1.1: Try changing the environment variable VERBOSE to 1</span>
<span class="c1"># (True) and 0 (False) to see the effect.</span>

<span class="c1"># ANSWER</span>
<span class="c1"># this sets verbose mode and prints a message</span>
<span class="c1"># &#39;RATstart found ok&#39; if it finds the librat RATstart</span>
<span class="c1"># executable</span>
<span class="nb">echo</span>  <span class="s2">&quot;----set VERBOSE 1---&quot;</span>
<span class="nb">export</span> <span class="nv">VERBOSE</span><span class="o">=</span><span class="m">1</span>
<span class="nb">source</span> examples_init.sh
<span class="c1"># it would be correct, in this instance to use</span>
<span class="c1"># export VERBOSE=1</span>
<span class="c1"># $INIT</span>
<span class="c1"># as there is no real need to source the file</span>
<span class="c1"># Above, the export in &#39;export VERBOSE=1&#39; is not</span>
<span class="c1"># strictly needed if we source $INIT, but it is otherwise</span>

<span class="c1"># this turns off the verbose mode</span>
<span class="c1"># so no message is printed</span>
<span class="nb">echo</span> <span class="s2">&quot;----set VERBOSE 0---&quot;</span>
<span class="nb">export</span> <span class="nv">VERBOSE</span><span class="o">=</span><span class="m">0</span>
<span class="nb">source</span> examples_init.sh
<span class="c1"># it would be correct, in this instance to use</span>
<span class="c1"># export VERBOSE=0</span>
<span class="c1"># $INIT</span>
<span class="c1"># as there is no real need to source the file</span>
<span class="c1"># Above, the export in &#39;export VERBOSE=1&#39; is not</span>
<span class="c1"># strictly needed if we source $INIT, but it is otherwise</span>

<span class="c1"># 1.2: You can change the name of the directory where the</span>
<span class="c1"># object and material files are through the</span>
<span class="c1"># environment variable BPMSROOT.</span>
<span class="c1"># See if you can find what BPMSROOT is set to,</span>
<span class="c1"># and also see if yoiu can modify it.</span>

<span class="c1"># ANSWER</span>
<span class="c1"># we need to see the value of the</span>
<span class="c1"># environment variable BPMSROOT, but we need it</span>
<span class="c1"># in this shell. So we *source* the file</span>
<span class="c1"># rather than running it.</span>
<span class="nb">echo</span> <span class="s2">&quot;----get BPMSROOT---&quot;</span>
<span class="nb">source</span> examples_init.sh
<span class="nb">echo</span> <span class="s2">&quot;BPMSROOT is </span><span class="nv">$BPMSROOT</span><span class="s2">&quot;</span>
<span class="nb">echo</span> <span class="s2">&quot;----set BPMSROOT---&quot;</span>
<span class="c1"># To change it, just set it before sourcing</span>
<span class="nb">export</span> <span class="nv">BPMSROOT</span><span class="o">=</span><span class="s2">&quot;/tmp&quot;</span>
<span class="nb">source</span> examples_init.sh
<span class="nb">echo</span> <span class="s2">&quot;BPMSROOT is </span><span class="nv">$BPMSROOT</span><span class="s2">&quot;</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
----set VERBOSE 1---
RATstart found ok
----set VERBOSE 0---
----get BPMSROOT---
BPMSROOT is /Users/plewis/librat/obj
----set BPMSROOT---
BPMSROOT is /tmp
</pre></div></div>
</div>
</div>
<div class="section" id="Making-some-basic-files">
<h2><span class="section-number">1.3. </span>Making some basic files<a class="headerlink" href="#Making-some-basic-files" title="Permalink to this headline">¶</a></h2>
<div class="section" id="bash-constructs">
<h3><span class="section-number">1.3.1. </span><code class="docutils literal notranslate"><span class="pre">bash</span></code> constructs<a class="headerlink" href="#bash-constructs" title="Permalink to this headline">¶</a></h3>
<p>We will create the files we need as we go along, using <code class="docutils literal notranslate"><span class="pre">bash</span></code> shell <code class="docutils literal notranslate"><span class="pre">cat</span> <span class="pre">&lt;&lt;EOF</span> <span class="pre">&gt;</span> <span class="pre">filename</span></code> syntax for multi-line data input. You may have noticed that we did this above in creating the <code class="docutils literal notranslate"><span class="pre">init</span></code> file.</p>
<p>If we type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="o">&lt;&lt;</span><span class="n">EOF</span> <span class="o">&gt;</span> <span class="n">filename</span>
<span class="n">this</span> <span class="ow">is</span> <span class="n">line</span> <span class="mi">1</span>
<span class="n">this</span> <span class="ow">is</span> <span class="n">line</span> <span class="mi">2</span>
<span class="n">EOF</span>
</pre></div>
</div>
<p>then a file called <code class="docutils literal notranslate"><span class="pre">filename</span></code> will be generated, containing the information up to the <code class="docutils literal notranslate"><span class="pre">EOF</span></code> marker:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">this</span> <span class="ow">is</span> <span class="n">line</span> <span class="mi">1</span>
<span class="n">this</span> <span class="ow">is</span> <span class="n">line</span> <span class="mi">2</span>
</pre></div>
</div>
<p>In a similar fashion, if we type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="o">&lt;&lt;&lt;</span><span class="s2">&quot;this is line 1&quot;</span> <span class="o">&gt;</span> <span class="n">filename</span>
</pre></div>
</div>
<p>(note the quotes!) then we can create a single line file with the contents:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">this</span> <span class="ow">is</span> <span class="n">line</span> <span class="mi">1</span>
</pre></div>
</div>
<p>This is equivalent to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="s2">&quot;this is line 1&quot;</span> <span class="o">|</span> <span class="n">cat</span> <span class="o">&gt;</span> <span class="n">filename</span>
</pre></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre>
<span></span>%%bash

cat <span class="o">&lt;&lt;&lt;</span><span class="s2">&quot;hello world&quot;</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
hello world
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre>
<span></span>%%bash

cat <span class="s">&lt;&lt; EOF</span>
<span class="s">hello world</span>
<span class="s">EOF</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
hello world
</pre></div></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">EXERCISE</span> <span class="mi">2</span>

    <span class="mf">1.</span> <span class="n">Use</span> <span class="n">these</span> <span class="n">shell</span> <span class="n">constructs</span> <span class="k">as</span> <span class="n">appropriate</span> <span class="n">to</span> <span class="n">create</span> <span class="n">a</span> <span class="n">file</span> <span class="n">called</span> <span class="n">green</span><span class="o">.</span><span class="n">dat</span><span class="p">,</span> <span class="k">with</span> <span class="mi">2</span> <span class="n">columns</span> <span class="n">of</span> <span class="n">data</span><span class="p">,</span> <span class="n">the</span> <span class="n">first</span> <span class="n">being</span> <span class="n">wavelength</span> <span class="ow">in</span> <span class="n">nm</span><span class="p">,</span> <span class="n">the</span> <span class="n">second</span> <span class="n">being</span> <span class="n">reflectance</span><span class="p">,</span> <span class="n">representing</span> <span class="n">a</span> <span class="n">typical</span> <span class="n">green</span> <span class="n">spectrum</span><span class="p">,</span> <span class="k">for</span> <span class="n">samples</span> <span class="n">at</span> <span class="mi">450</span> <span class="n">nm</span><span class="p">,</span> <span class="mi">550</span> <span class="n">nm</span> <span class="ow">and</span> <span class="mi">650</span> <span class="n">nm</span><span class="o">.</span>

    <span class="mf">2.</span> <span class="n">Use</span> <span class="n">these</span> <span class="n">shell</span> <span class="n">constructs</span> <span class="k">as</span> <span class="n">appropriate</span> <span class="n">to</span> <span class="n">create</span> <span class="n">a</span> <span class="n">file</span> <span class="n">called</span> <span class="n">white</span><span class="o">.</span><span class="n">dat</span><span class="p">,</span> <span class="k">with</span> <span class="mi">2</span> <span class="n">columns</span> <span class="n">of</span> <span class="n">data</span><span class="p">,</span> <span class="n">the</span> <span class="n">first</span> <span class="n">being</span> <span class="n">wavelength</span> <span class="ow">in</span> <span class="n">nm</span><span class="p">,</span> <span class="n">the</span> <span class="n">second</span> <span class="n">being</span> <span class="n">reflectance</span><span class="p">,</span> <span class="n">representing</span> <span class="n">a</span> <span class="n">white</span> <span class="n">spectrum</span><span class="p">,</span> <span class="k">for</span> <span class="n">samples</span> <span class="n">at</span> <span class="mi">450</span> <span class="n">nm</span><span class="p">,</span> <span class="mi">550</span> <span class="n">nm</span> <span class="ow">and</span> <span class="mi">650</span> <span class="n">nm</span><span class="o">.</span>
</pre></div>
</div>
<p><strong>Answers below:</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre>
<span></span>%%bash

<span class="c1"># Answers to Exercise 2</span>

<span class="c1"># 2.1 green: high at 550 nm, low at 450 and 650 nm</span>
<span class="c1"># Its a multi-line file that we need, so</span>
cat <span class="s">&lt;&lt; EOF &gt; $BPMS/obj/green_.dat</span>
<span class="s">450 0.1</span>
<span class="s">550 0.9</span>
<span class="s">650 0.1</span>
<span class="s">EOF</span>

<span class="c1"># 2.2 white: high at all</span>
<span class="c1"># Its a multi-line file that we need, so</span>
cat <span class="s">&lt;&lt; EOF &gt; $BPMS/obj/white_.dat</span>
<span class="s">450 0.1</span>
<span class="s">550 0.9</span>
<span class="s">650 0.1</span>
<span class="s">EOF</span>

<span class="c1"># show results:</span>
<span class="nb">echo</span> <span class="s2">&quot;========&quot;</span>
<span class="nb">echo</span> <span class="s2">&quot;green&quot;</span>
<span class="nb">echo</span> <span class="s2">&quot;========&quot;</span>
cat <span class="nv">$BPMS</span>/obj/green_.dat

<span class="nb">echo</span> <span class="s2">&quot;========&quot;</span>
<span class="nb">echo</span> <span class="s2">&quot;white&quot;</span>
<span class="nb">echo</span> <span class="s2">&quot;========&quot;</span>
cat <span class="nv">$BPMS</span>/obj/white_.dat

<span class="c1"># be polite and tidy up</span>
rm -f <span class="nv">$BPMS</span>/obj/green_.dat <span class="nv">$BPMS</span>/obj/white_.dat
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
========
green
========
450 0.1
550 0.9
650 0.1
========
white
========
450 0.1
550 0.9
650 0.1
</pre></div></div>
</div>
</div>
<div class="section" id="first.obj-and-associated-files">
<h3><span class="section-number">1.3.2. </span><code class="docutils literal notranslate"><span class="pre">first.obj</span></code> and associated files<a class="headerlink" href="#first.obj-and-associated-files" title="Permalink to this headline">¶</a></h3>
<p>Now we will use these constructs to put some text some files in that directory. We will be creating files that we need to run a radiative transfer simulation. We will look into what these mean and their formats later in the notes.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre>
<span></span>%%bash

<span class="nb">source</span> examples_init.sh
<span class="c1"># simple object file</span>
<span class="c1"># with green plane</span>
<span class="c1"># and sphere of radius 100 mm</span>
<span class="c1"># centred at (0,0,0)</span>
cat <span class="s">&lt;&lt;EOF &gt; $BPMSROOT/first.obj</span>
<span class="s"># My first object file</span>
<span class="s">mtllib plants.matlib.new</span>
<span class="s">usemtl green</span>
<span class="s">v 0 0 0</span>
<span class="s">v 0 0 1</span>
<span class="s">plane -1 -2</span>
<span class="s">!{</span>
<span class="s">usemtl white</span>
<span class="s">!{</span>
<span class="s">v 0 0 0</span>
<span class="s">sph -1 1</span>
<span class="s">!}</span>
<span class="s">!}</span>
<span class="s">EOF</span>

<span class="c1"># wavelengths (nm)</span>
cat <span class="s">&lt;&lt;EOF &gt; $BPMSROOT/wavebands.dat</span>
<span class="s">1 650</span>
<span class="s">2 550</span>
<span class="s">3 450</span>
<span class="s">EOF</span>

<span class="c1"># spectrum for white</span>
cat <span class="s">&lt;&lt;EOF &gt; $BPMSROOT/white.dat</span>
<span class="s">450 1</span>
<span class="s">550 1</span>
<span class="s">650 1</span>
<span class="s">EOF</span>

<span class="c1"># spectrum for green</span>
cat <span class="s">&lt;&lt;EOF &gt; $BPMSROOT/green.dat</span>
<span class="s">450 0.1</span>
<span class="s">550 0.5</span>
<span class="s">650 0.1</span>
<span class="s">EOF</span>

<span class="c1"># library listing materials</span>
cat <span class="s">&lt;&lt;EOF &gt; $BPMSROOT/plants.matlib.new</span>
<span class="s">srm green green.dat</span>
<span class="s">srm white white.dat</span>
<span class="s">EOF</span>
</pre></div>
</div>
</div>
<p>The scene object described in <code class="docutils literal notranslate"><span class="pre">first.obj</span></code> is a sphere of radius 1, centred at location <code class="docutils literal notranslate"><span class="pre">(0,</span> <span class="pre">0,</span> <span class="pre">0)</span></code>, as well as a plane with normal <code class="docutils literal notranslate"><span class="pre">(0,</span> <span class="pre">0,</span> <span class="pre">1)</span></code> passing through location <code class="docutils literal notranslate"><span class="pre">(0,</span> <span class="pre">0,</span> <span class="pre">0)</span></code>. The sphere is <code class="docutils literal notranslate"><span class="pre">white</span></code> and the plane is <code class="docutils literal notranslate"><span class="pre">green</span></code>.</p>
</div>
<div class="section" id="height-map-visualisation">
<h3><span class="section-number">1.3.3. </span>height map visualisation<a class="headerlink" href="#height-map-visualisation" title="Permalink to this headline">¶</a></h3>
<p>In the first example, we produce a visualisation of the object using option <code class="docutils literal notranslate"><span class="pre">16</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">16</span> <span class="n">cx</span> <span class="n">cy</span> <span class="n">cz</span> <span class="n">sx</span> <span class="n">sy</span> <span class="n">nrows</span> <span class="n">ncols</span> <span class="n">rpp</span> <span class="n">name</span> <span class="p">:</span> <span class="n">produce</span> <span class="n">a</span> <span class="n">height</span> <span class="nb">map</span> <span class="ow">in</span> <span class="n">name</span>
</pre></div>
</div>
<p>Option 16 produces an image dataset (in a rather old ‘hips’ format) that is a height map of the scene, produced by ray casting. Imagine a rectangle on an x-y plane of physical dimensions (sx, sy), centred at (cx, cy, cz).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre>
<span></span>%%bash
<span class="nb">source</span> examples_init.sh
<span class="c1"># option 8</span>
RATstart first.obj <span class="s">&lt;&lt; EOF</span>
<span class="s">16 0 0 4 4 4 200 200 1 $BPMS/obj/out.tmp.hips</span>
<span class="s">EOF</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
( 99.9975)
</pre></div></div>
</div>
<p>We can use the python library <code class="docutils literal notranslate"><span class="pre">libhipl</span></code> from <code class="docutils literal notranslate"><span class="pre">RATlibUtils</span></code> to read (and write) hips format images:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">RATlibUtils.libhipl</span> <span class="kn">import</span> <span class="n">Hipl</span>
<span class="kn">import</span> <span class="nn">pylab</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">BPMS</span><span class="o">+</span><span class="s1">&#39;/obj/out.tmp.hips&#39;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">Hipl</span><span class="p">()</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">f</span><span class="p">),</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.colorbar.Colorbar at 0x118bd3790&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/RATstart_34_1.svg" src="_images/RATstart_34_1.svg" /></div>
</div>
<p>In the visualisation we can see the shere and plane as a height map. The height varies from 0 (the plane) to 1 (at the top of the sphere). The extent of the scene is <code class="docutils literal notranslate"><span class="pre">4</span> <span class="pre">x</span> <span class="pre">4</span></code> units, so we can confirm that the radius of the sphere is 1 unit by inspection.</p>
</div>
<div class="section" id="Ray-tracing">
<h3><span class="section-number">1.3.4. </span>Ray tracing<a class="headerlink" href="#Ray-tracing" title="Permalink to this headline">¶</a></h3>
<p>And now another example.</p>
<p>We run this with the verbose flag set on running <code class="docutils literal notranslate"><span class="pre">RATstart</span></code>.</p>
<p>The input:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">1</span> <span class="mi">3</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">0</span> <span class="mi">1</span>
</pre></div>
</div>
<p>(option <code class="docutils literal notranslate"><span class="pre">1</span></code>) sets the number of suns (3) followed by the sun direction vectors <code class="docutils literal notranslate"><span class="pre">(0,</span> <span class="pre">1,</span> <span class="pre">1)</span></code> <code class="docutils literal notranslate"><span class="pre">(1,</span> <span class="pre">1,</span> <span class="pre">1)</span></code> and <code class="docutils literal notranslate"><span class="pre">(1,</span> <span class="pre">0,</span> <span class="pre">1)</span></code> here. In practice, we tend to run simulations with a single illumination (sun) vector, but we illustrate using 3 here to encourage the use of this option.</p>
<p>The input:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">6</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">10</span> <span class="mi">0</span> <span class="mi">0</span> <span class="o">-</span><span class="mi">1</span>
</pre></div>
</div>
<p>(option <code class="docutils literal notranslate"><span class="pre">6</span></code>) sets up a ray tracing case, for a ray <em>from</em> location <code class="docutils literal notranslate"><span class="pre">(0</span> <span class="pre">0</span> <span class="pre">10)</span></code>, in direction <code class="docutils literal notranslate"><span class="pre">(0</span> <span class="pre">0</span> <span class="pre">-1)</span></code> (straight down).</p>
<p>We set the <code class="docutils literal notranslate"><span class="pre">-RATtolerance</span></code> command line option to a small number, relative to scene size objects: <code class="docutils literal notranslate"><span class="pre">0.0000001</span></code> is sufficient in this case.</p>
<p>We should be able to visualise this situation, and see that the ray will hit the sphere at <code class="docutils literal notranslate"><span class="pre">(0</span> <span class="pre">0</span> <span class="pre">1)</span></code>, so be of length 9 units.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre>
<span></span>%%bash
<span class="nb">source</span> examples_init.sh

RATstart -RATtolerance <span class="m">0</span>.0000001 -RATsensor_wavebands wavebands.dat first.obj <span class="s">&lt;&lt;EOF</span>
<span class="s">1 3 0 1 1 1 1 1 1 0 1</span>
<span class="s">6 0 0 10 0 0 -1</span>
<span class="s">EOF</span>

</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RTD 0
order: 0        intersection point:     0.000000 0.000000 1.000000
                ray length:             9.000000
                intersection material:  3
                sun 0:                  1 reflectance
                direct:                 0.707107 0.707107 0.707107
                sun 1:                  1 reflectance
                direct:                 0.577350 0.577350 0.577350
                sun 2:                  1 reflectance
                direct:                 0.707107 0.707107 0.707107
                sky  :                  reflectance
                diffuse:                1.000000 1.000000 1.000000
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
how many sun vectors? (&gt;0): enter sun vector number 1 (3 floats): enter sun vector number 2 (3 floats): enter sun vector number 3 (3 floats):
</pre></div></div>
</div>
<p>In the example above, we hit the sphere at its apex. The normal vector of the sphere at that point is <code class="docutils literal notranslate"><span class="pre">(0,0,1)</span></code> and the material reflectance (<code class="docutils literal notranslate"><span class="pre">white</span></code>) is 1.0 at all wavelengths. So we might notice that the <code class="docutils literal notranslate"><span class="pre">direct</span></code> reflectance above is always the cosine of the angle between the normal vector <code class="docutils literal notranslate"><span class="pre">(0,0,1)</span></code> and the solar vector.</p>
<p>We explore this in the code below by calculating the <a class="reference external" href="https://mathworld.wolfram.com/DotProduct.html">vector dot product</a> of the sun and normal unit vectors. Note that the unit vectors have unit (1) length, so if we define them as vectors of arbitrary length (e.g. <code class="docutils literal notranslate"><span class="pre">(1,</span> <span class="pre">1,</span> <span class="pre">1)</span></code>) we need to normalise them (divide by the length, to give the unit length):</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">linalg</span> <span class="k">as</span> <span class="n">LA</span>

<span class="c1">#### dot product for angle ####</span>

<span class="n">sun</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">1.</span><span class="p">])</span>
<span class="c1"># normalise vector</span>
<span class="n">length</span> <span class="o">=</span> <span class="n">LA</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">sun</span><span class="p">)</span>
<span class="n">sunHat</span> <span class="o">=</span> <span class="n">sun</span><span class="o">/</span><span class="n">length</span>

<span class="n">normal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.</span><span class="p">])</span>
<span class="c1"># normalise vector</span>
<span class="n">length</span> <span class="o">=</span> <span class="n">LA</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">normal</span><span class="p">)</span>
<span class="n">normalHat</span> <span class="o">=</span> <span class="n">normal</span><span class="o">/</span><span class="n">length</span>

<span class="n">cosine</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">sunHat</span><span class="p">,</span><span class="n">normalHat</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;cosine of&quot;</span><span class="p">,</span><span class="n">sun</span><span class="p">,</span><span class="s2">&quot;=&quot;</span><span class="p">,</span><span class="n">cosine</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
cosine of [1. 1. 1.] = 0.5773502691896258
</pre></div></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">EXERCISE</span> <span class="mi">3</span>

<span class="n">Adapt</span> <span class="n">the</span> <span class="n">RATstart</span> <span class="n">example</span> <span class="n">above</span> <span class="n">to</span> <span class="n">have</span> <span class="n">just</span> <span class="n">a</span> <span class="n">single</span> <span class="n">sun</span> <span class="n">vector</span><span class="o">.</span>

<span class="n">Change</span> <span class="n">the</span> <span class="n">sun</span> <span class="n">vector</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">RATstart</span> <span class="n">example</span><span class="p">,</span> <span class="ow">and</span> <span class="n">use</span> <span class="n">the</span> <span class="n">python</span> <span class="n">code</span> <span class="n">above</span> <span class="n">to</span> <span class="n">predict</span> <span class="n">what</span> <span class="n">the</span> <span class="n">direct</span> <span class="n">reflectance</span> <span class="n">will</span> <span class="n">be</span><span class="o">.</span> <span class="n">Do</span> <span class="n">this</span> <span class="k">for</span> <span class="n">several</span> <span class="n">examples</span><span class="o">.</span>
</pre></div>
</div>
<p><strong>Answers below:</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre>
<span></span>%%bash
<span class="c1">#</span>
<span class="c1"># set a single sun vector, here (0,0,1)</span>
<span class="c1"># so dot product = 1.0 and direct refl = 1</span>
<span class="c1">#</span>
<span class="nb">source</span> examples_init.sh

RATstart -RATtolerance <span class="m">0</span>.0000001 -RATsensor_wavebands wavebands.dat first.obj <span class="s">&lt;&lt;EOF</span>
<span class="s">1 1 0 0 1</span>
<span class="s">6 0 0 10 0 0 -1</span>
<span class="s">EOF</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RTD 0
order: 0        intersection point:     0.000000 0.000000 1.000000
                ray length:             9.000000
                intersection material:  3
                sun 0:                  1 reflectance
                direct:                 1.000000 1.000000 1.000000
                sky  :                  reflectance
                diffuse:                1.000000 1.000000 1.000000
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
how many sun vectors? (&gt;0): enter sun vector number 1 (3 floats):
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">linalg</span> <span class="k">as</span> <span class="n">LA</span>

<span class="c1">#### dot product for angle ####</span>

<span class="n">sun</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.</span><span class="p">])</span>
<span class="c1"># normalise vector</span>
<span class="n">length</span> <span class="o">=</span> <span class="n">LA</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">sun</span><span class="p">)</span>
<span class="n">sunHat</span> <span class="o">=</span> <span class="n">sun</span><span class="o">/</span><span class="n">length</span>

<span class="n">normal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.</span><span class="p">])</span>
<span class="c1"># normalise vector</span>
<span class="n">length</span> <span class="o">=</span> <span class="n">LA</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">normal</span><span class="p">)</span>
<span class="n">normalHat</span> <span class="o">=</span> <span class="n">normal</span><span class="o">/</span><span class="n">length</span>

<span class="n">cosine</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">sunHat</span><span class="p">,</span><span class="n">normalHat</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;cosine of&quot;</span><span class="p">,</span><span class="n">sun</span><span class="p">,</span><span class="s2">&quot;=&quot;</span><span class="p">,</span><span class="n">cosine</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
cosine of [0. 0. 1.] = 1.0
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre>
<span></span>%%bash
<span class="c1">#</span>
<span class="c1"># set a single sun vector, here (0,1,1)</span>
<span class="c1"># so dot product = 0.707 (sqrt(2))</span>
<span class="c1"># and so direct refl = 0.707</span>
<span class="c1">#</span>
<span class="nb">source</span> examples_init.sh

RATstart -RATtolerance <span class="m">0</span>.0000001 -RATsensor_wavebands wavebands.dat first.obj <span class="s">&lt;&lt;EOF</span>
<span class="s">1 1 0 1 1</span>
<span class="s">6 0 0 10 0 0 -1</span>
<span class="s">EOF</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RTD 0
order: 0        intersection point:     0.000000 0.000000 1.000000
                ray length:             9.000000
                intersection material:  3
                sun 0:                  1 reflectance
                direct:                 0.707107 0.707107 0.707107
                sky  :                  reflectance
                diffuse:                1.000000 1.000000 1.000000
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
how many sun vectors? (&gt;0): enter sun vector number 1 (3 floats):
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">linalg</span> <span class="k">as</span> <span class="n">LA</span>

<span class="c1">#### dot product for angle ####</span>

<span class="n">sun</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">1.</span><span class="p">])</span>
<span class="c1"># normalise vector</span>
<span class="n">length</span> <span class="o">=</span> <span class="n">LA</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">sun</span><span class="p">)</span>
<span class="n">sunHat</span> <span class="o">=</span> <span class="n">sun</span><span class="o">/</span><span class="n">length</span>

<span class="n">normal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.</span><span class="p">])</span>
<span class="c1"># normalise vector</span>
<span class="n">length</span> <span class="o">=</span> <span class="n">LA</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">normal</span><span class="p">)</span>
<span class="n">normalHat</span> <span class="o">=</span> <span class="n">normal</span><span class="o">/</span><span class="n">length</span>

<span class="n">cosine</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">sunHat</span><span class="p">,</span><span class="n">normalHat</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;cosine of&quot;</span><span class="p">,</span><span class="n">sun</span><span class="p">,</span><span class="s2">&quot;=&quot;</span><span class="p">,</span><span class="n">cosine</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
cosine of [0. 1. 1.] = 0.7071067811865475
</pre></div></div>
</div>
</div>
<div class="section" id="Summary">
<h3><span class="section-number">1.3.5. </span>Summary<a class="headerlink" href="#Summary" title="Permalink to this headline">¶</a></h3>
<p>In this section, we have introduced the <code class="docutils literal notranslate"><span class="pre">RATstart</span></code> code, some information about the requirements for running the code. We generated some initialisation scripts to simplify setting up environment variables, generated a simple world object (sphere on a plane) and visualised this.</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="RATstartOptions.html" class="btn btn-neutral float-right" title="2. RATstart options" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="Welcome to librat" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Prof. P. Lewis.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> and ❤️  using a custom <a href="https://github.com/LinxiFan/Stanford-theme">theme</a> based on <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="_static/language_data.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>